<!DOCTYPE html>
<html>
  <!-- (adapted from PS 2018) -->
  <head>
    <title>Arrow Experiment</title>
    <!-- Preload javascript and css files -->
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <script src="https://wnarhi.github.io/Arrow/jquery.min.js"></script>
    <script src="https://wnarhi.github.io/Arrow/jspsych.js"></script>
    <script src="https://wnarhi.github.io/Arrow/TimTurkTools.js"></script>
    <script src="https://wnarhi.github.io/Arrow/chance.js"></script>
    <script src="https://wnarhi.github.io/Arrow/seedrandom.js"></script>
    <script>const startDate = new Date(); const chance1 = Chance(startDate); Math.seedrandom(chance1.seed); // Use current time as the shuffle seed, so you can trace back their trials</script>
    <script src="https://wnarhi.github.io/Arrow/jspsych-html-keyboard-response.js"></script>
    <script src="https://wnarhi.github.io/Arrow/jspsych-image-keyboard-response.js"></script>
    <link href="https://wnarhi.github.io/Arrow/ScreenFormatting.css" rel="stylesheet" type="text/css"></link>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
    <!-- Preload images -->
    <script src="https://wnarhi.github.io/Arrow/Stimuli/LoadStimuli.js"></script>    
  </head>

  <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
      apiKey: "AIzaSyDzhLYalLDu9SuW7a1Z3cTmUoQkE48c6ho",
      authDomain: "online-data-8bab7.firebaseapp.com",
      databaseURL: "https://online-data-8bab7.firebaseio.com",
      projectId: "online-data-8bab7",
      storageBucket: "online-data-8bab7.appspot.com",
      messagingSenderId: "546730698231",
      appId: "1:546730698231:web:c3286536d41feba0063af2",
      measurementId: "G-J17135W661"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // firebase.analytics();

    var fullScreen = 0;
  </script>

  <body>
    <!-- Consent statement: -->
    <div id="consentDiv">
      <h1>The Ohio State University Consent to Participate in Research</h1>
      <h2>Study Title: Attention and feature reporting</h2>
      <h2>Researchers: William Narhi & Julie D. Golomb</h2>
      <p><b>This is a consent form for research participation.</b> It contains important information about this study and what to expect if you decide to participate.</p>
      <p><b>Your participation is voluntary.</b></p>
      <p>Please consider the information carefully. Feel free to email questions to the researchers before making your decision whether or not to participate. If you decide to participate, you will be asked to click a button below this form.</p>
      <p><b>Purpose:</b> In this experiment, we are interested in understanding how humans are able to control their attention to focus on relevant information, and how attention is related to other cognitive abilities and traits.</p>
      <p><b>Tasks:</b> Your participation involves watching various visual events on a computer screen and responding to what you saw. Additionally, you may be asked to complete a survey. You will be provided with detailed written instructions at the start of each task or survey.</p>
      <p><b>Duration:</b> The experiment is expected to take the duration listed in the study description. You may leave the study at any time. If you decide to stop participating in the study, there will be no penalty to you, and you will not lose any benefits to which you are otherwise entitled. Your decision will not affect your future relationship with The Ohio State University.</p>
      <p><b>Risks and Benefits:</b> There is no more risk associated with participation than you would normally encounter while playing a simple video game. Benefits include the advancement of scientific knowledge, experiencing the research process, and learning about visual cognition.</p>
      <p><b>Confidentiality:</b> Upon completion of the study, your information will be made available to the experimenters. Only select lab personnel will have access to your information.</p>
      <p>The data that you provide in the experiment will be stored temporarily on a secure private online server or on the web-survey platform Qualtrics, then transferred to our secure lab computers. Your name or contact information will not be collected during the experiment. Only select lab personnel who have received training in human subjects protection and clearance to handle data for this project will have access to your results. We will work to make sure that no one sees your data without approval. But, because we are using the Internet, there is a chance that someone could access your online responses without permission. In some cases, this information could be used to identify you. Your data will be protected with a code to reduce the risk that other people can view the responses. However, there are rare instances when the researcher may be required to share personally identifiable information. For example, in response to a complaint about the research, officials at The University and/or regulatory oversight government agencies (National Science Foundation) may access research data.  The researcher is also required by law to report certain information to government and/or law enforcement officials (e.g., threatened violence against self or others, communicable diseases).</p>
      <p>The NIH issues Certificates of Confidentiality for all NIH-funded studies, including this study. This Certificate provides extra protection for you and your study information, documents, or samples (blood, tissue, etc.). The Certificates are issued so that we cannot be required to disclose any identifiable information collected about you as a part of this study in a lawsuit or legal proceeding. This is a layer of protection over and above the already existing protections in place for you and your information, documents, or samples. However, these protections do not apply in some situations. For example, we may have to release your information if a law requires us to do so, if the NIH (which is funding this study) requests the information, or if the FDA tells us to release this information. The data collected in this study as well as the results of the research can be used for scientific purposes and may be published (in ways that do not personally identify you). An anonymized version of the data from this study may be made publicly accessible, for example via the Open Science Framework (osf.io). The anonymized data can be used for re-analysis and additional analyses by other researchers. The purpose and scope of this secondary use is not foreseeable. Any personal information that could directly identify you will be removed before data and results are made public. Personal information will be protected closely so no one will be able to connect your responses and any other information that identifies you. All personally identifying information collected will be stored separately from all other data. You can revoke consent to use your data until the end of data collection. This will not cause you any disadvantages.</p>
      <p><b>Incentives:</b> You will receive the credit amount listed in the REP description (based on a rate of 1 credit/hour). If you withdraw early for any reason, your credit will be prorated to the nearest increment of 30 minutes based on a 1 credit/hour rate, up until the amount indicated in the study description. If you withdraw early, please contact the researcher at narhi-martinez.1@osu.edu to ensure you receive your credit.</p>
      <p><b>Participant Rights:</b> You may refuse to participate in this study without penalty or loss of benefits to which you are otherwise entitled. If you are a student or employee at The Ohio State University, your decision will not affect your grades or employment status.</p>
      <p>If you choose to participate in the study, you may discontinue participation at any time without penalty or loss of benefits. By consenting below, you do not give up any personal legal rights you may have as a participant in this study.</p>
      <p>An Institutional Review Board responsible for human subjects research at The Ohio State University reviewed this research project and found it to be acceptable, according to applicable state and federal regulations and University policies designed to protect the rights and welfare of participants in research.</p>
      <p><b>Contacts and Questions:</b> For questions, concerns, or complaints about the study, or you feel you have been harmed as a result of study participation, you may contact William Narhi at narhi-martinez.1@osu.edu. For questions about your rights as a participant in this study or to discuss other study-related concerns or complaints with someone who is not part of the research team, you may contact Ms. Sandra Meadows in the Office of Responsible Research Practices at meadows.8@osu.edu.</p>
      <p><b>Electronic consent:</b> You may print a copy of this consent form for your records. If you wish to continue with the experiment, please click the button below.</p>
      <p><center><b>Clicking the button below indicates that:</b><ul><li>You have read the above information</li><li>You are between 18 and 40 years of age</li><li>You have normal or corrected-to-normal visual acuity and color vision</li><li>You voluntarily agree to participate</li></ul></center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#consentDiv').hide();$('#instructions1').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="startExperimentButton" style="display: inline;">I consent to participate in this study</a></center></p>
    </div>

    <!-- Formatting -->
    <style>
      .instruct {
        width:500;
        height:500;
      }

      .centInst {
        position: relative;
        height:500;
        width:500;
        left:750;
      }

      .center {
        position: absolute;
        top:300px;
        left:300px;
        transform: translate(-50%, -50%);
      }

      </style>
    <!-- Instructions: -->
    <div class="instruct" id="instructions1" style="display: none">
      <p><b><center>This study lasts approximately one hour.<br>You will receive 1 REP credit for study completion. <br>If you have previously completed this study then you are ineligible to participate.</b><br>Please do not disable the creation of text dialogs as these will sometimes be used to relay instructions.</center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions1').hide();$('#instructions2').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct1" style="display: inline;">Press here to begin viewing a trial walkthrough</a></center></p>
    </div>
    <div class="instruct" id="instructions2" style="display: none">
      <p><center>In this study, you will report the color of a square.</center></p>
      <p><center>Every trial will start with an arrow indicating one of four locations on your screen. For example:</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/ArrowExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions2').hide();$('#instructions3').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct2" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions3" style="display: none">
      <p><center>Next, four colored squares will appear, try and remember all of them. For example:</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/SquaresExample.png" width=500></img></center>
      </div>
      <p><center>Be sure to keep your eyes fixated on the center dot for as long as it is on your screen, as your target could appear at any of the four locations.</center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions3').hide();$('#instructions4').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct3" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions4" style="display: none">
      <p><center>A black frame will then appear in one of the four locations, indicating which square we would like you to report the color of. For example:</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/TargetExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions4').hide();$('#instructions5').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct4" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions5" style="display: none">
      <p><center>You will report the color of the square that had appeared in the same location as the <b>black frame</b> to the best of your ability on a color wheel by clicking on a color using your mouse (trackpad not recommended).</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/WheelExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions5').hide();$('#instructions6').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct5" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions6" style="display: none">
      <p><center>Lastly, you will let us know how confident you feel in the color you selected on a scale from <b>1 (completely guessing)</b> to <b>4 (highly confident)</b> by pressing the corresponding number key (1, 2, 3, or 4).</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/ConfidenceExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions6').hide();$('#instructions7').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct6" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions7" style="display: none">
      <p><center>The correct color will then be revealed to you before the next trial begins</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/FeedbackExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions7').hide();$('#instructions8').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct7" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions8" style="display: none">
      <p><center>The location cued by the arrow will match the location of the black frame most of the time, but not all of the time.<br>Remember that we want you to report the color indicated by the <b><em>black frame</em></b> on every trial, regardless of where the arrow was pointing.</center></p>
      <p><center>For instance, in the example trial you just viewed the arrow had indicated the upper left square, but the black frame appeared in the lower right.<br>Therefore, we wanted you to report the color that had appeared in the lower right</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/FinalExample.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions8').hide();$('#instructions9').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct8" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions9" style="display: none">
      <p><center>Here is an example of a different possible trial:</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/FinalExample2.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions9').hide();$('#instructions10').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct9" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions10" style="display: none">
      <p><center>Here is an example of a different possible trial:</center></p>
      <div class="centInst">
        <center><img src="https://wnarhi.github.io/Arrow/Stimuli/FinalExample3.png" width=500></img></center>
      </div>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions10').hide();$('#instructions11').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct10" style="display: inline;">Press here to continue</a></center></p>
    </div>
    <div class="instruct" id="instructions11" style="display: none">
      <p><center>It is important that you be as <em>precise and as accurate as possible</em> when reporting the color of the target object. Also note that since this is an experiment designed to study memory, we require that you <b>complete this study in one sitting after starting this study</b>.</center></p>
      <p><center>Because this is a task that requires your focused attention, we require that you minimize all distractions for the duration of this study. You will be offered short breaks after every 64 trials.</center></p>
      <p><center>If you are unsure of the correct color, just give your best guess. You are not allowed to use any external tools to remember objects. The task should become easier over time as you get more practice with it, and all we ask is that you understand the task and give your best effort.</center></p>
      <p><center>After completing all the trials a short survey will be presented for you to answer before finishing the experiment.</center></p>
      <p><center>Your time is greatly appreciated!</center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions11').hide();$('#instructions1').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="instruct11" style="display: inline;">Click here to view this walkthrough again</a></center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#instructions11').hide();$('#popquiz').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="startQuiz" style="display: inline;">Click here to start the experiment</a></center></p>
    </div>
    <div class="instruct" id="popquiz" style="display: none">
      <p><center>Pop quiz! Which cue will indicate the colored square we want you to report on every trial?</center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#popquiz').hide();$('#instructions1').show();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="wrong" style="display: inline;">Black Arrow</a></center></p>
      <p style="text-align: center"><center><a href="javascript:void(0);" onclick="$('#popquiz').hide();GetInfo();document.body.scrollTop = document.documentElement.scrollTop = 0;" id="startExperimentButton" style="display: inline;">Black Frame</a></center></p>
    </div>

     <!-- Request Full-Screen --> 
     <div id="openModal" class="modalDialog">
      <div>
        <a href="#coolExperiment" onclick="requestFullScreen();NextTrial();startExpTime = new Date().getTime();" title="Close" class="close">S</a>
        <p id="openModal_text">Remember to always keep your eyes on the fixation dot!<br>Please click the 'S' to continue</p>
      </div>
    </div>

    <!-- Basic structure for a trial: -->
    <div id="showTrial" style="width:600px; height:600px;">
      <div id="fixation" class="center" style="cursor:none;">
        <img id="fixImg" src="https://wnarhi.github.io/Arrow/Stimuli/fixPoint.png" width=25 height=25></img>  
      </div>
      <div id="arrow" class="center" style="cursor:none;">
        <img id="arrImg" src="https://wnarhi.github.io/Arrow/Stimuli/Arrows/arrow1.png" width=100 height=100></img>  
      </div>
      <div id="allItems" class="center" style="width:400px; height:400px;" style="cursor:none;">
        <img id="squareUL" src="https://wnarhi.github.io/Arrow/Stimuli/Squares/square1.png" width=100 height=100 style="position:absolute; top:0; left:0"></img>
        <img id="squareUR" src="https://wnarhi.github.io/Arrow/Stimuli/Squares/square1.png" width=100 height=100 style="position:absolute; top:0; right:0"></img>
        <img id="squareLL" src="https://wnarhi.github.io/Arrow/Stimuli/Squares/square1.png" width=100 height=100 style="position:absolute; bottom:0; left:0"></img>
        <img id="squareLR" src="https://wnarhi.github.io/Arrow/Stimuli/Squares/square1.png" width=100 height=100 style="position:absolute; bottom:0; right:0"></img>
      </div>
      <div id="masks" class="center" style="width:400px; height:400px;" style="cursor:none;">
        <img id="squareUL" src="https://wnarhi.github.io/Arrow/Stimuli/mask.png" width=100 height=100 style="position:absolute; top:0; left:0"></img>
        <img id="squareUR" src="https://wnarhi.github.io/Arrow/Stimuli/mask.png" width=100 height=100 style="position:absolute; top:0; right:0"></img>
        <img id="squareLL" src="https://wnarhi.github.io/Arrow/Stimuli/mask.png" width=100 height=100 style="position:absolute; bottom:0; left:0"></img>
        <img id="squareLR" src="https://wnarhi.github.io/Arrow/Stimuli/mask.png" width=100 height=100 style="position:absolute; bottom:0; right:0"></img>
      </div>
      <div id="targ" class="center" style="width:400px; height:400px;" style="cursor:none;">
        <img id="targetImg" src="https://wnarhi.github.io/Arrow/Stimuli/target.png" width=100 height=100></img>
      </div>
      <div id="response" class="center">
        <img id="wheel" src="https://wnarhi.github.io/Arrow/Stimuli/Wheels/wheelCW.png" width=761 height=475></img>
      </div>
      <div id="confidence" class="center" style="cursor:none;">
        <p style="text-align: center">Confidence?<br>{from 1(low) to 4(high)}</p>
        <p><center><input type="text" id="confBox" style="text-align:center" size="5"></center></p>
      </div>
      <div id="feedback" class="center" style="cursor:none;">
        <img id="feedImg" src="https://wnarhi.github.io/Arrow/Stimuli/Wheels/feedbackCW1.png" width=761 height=475></img>
      </div>
      <div id="blockBreak" class="center">
        <p style="text-align: center" id="blockCount"></p>
        <p style="text-align: center">Press the button when you are ready to continue</p>
        <button style="position: absolute; text-align: center; left:50%; transform: translate(-50%, 0%);" onclick="$('#blockBreak').hide();trialNumber++;NextTrial();">Continue</button>
      </div>
    </div>

    <script>
      const wheelDiv = document.getElementById("response");
      const wheelRect = wheelDiv.getBoundingClientRect();
      const wheelXcenter = wheelRect.left + wheelRect.width * .5;
      const wheelYcenter = wheelRect.top + wheelRect.height * .5;
      var blockNumber = 1;
      const numBlocks = 8;
      var blockMessage = "End of block " + blockNumber + " of " + numBlocks;
      document.getElementById("blockCount").innerHTML = blockMessage;
      $('#showTrial').hide();
    </script>

    <!-- Screen after submitting expt -->
    <div id="done">
      <div id="doneText">
      </div>
      <div>
        <center>
          <a href="javascript:void(0);" onclick="checkEQ();" id="submitForm">Click to Submit</a>
        </center>
      </div>
    </div>

    <div id="debrief" class="center">
      <center>
      <p style="text-align:center"><b>Debrief:</b> The purpose of this experiment was to examine the influence of a<br>somewhat-reliable arrow cue on your attention and</br>the types of errors you would make when reporting the colors.</p>
      <p style="text-align:center">Feel free to email the experimenter, William Narhi, at narhi-martinez.1@osu.edu<br>if you have any questions or would like additional information.</br></p>
      <button style="position: absolute; text-align: center; left:50%; transform: translate(-50%, 0%);" onclick="$('#debrief').hide();SaveData();">Click here to confirm your completion</button>
      </center>
    </div>

    <div id="saving">Saving . . .</div>

    <script>
    $('#done').hide();
    $('#debrief').hide();
    </script>

    <script>
      /* disable context menu */
      document.oncontextmenu = function() {
          return false;
      }

      const SeedRNG = Math.seedrandom();
      const seedID = Chance(SeedRNG); // Use their ID as the shuffle seed, so you can trace back their trials
      const numTrials = 64;
      const trialList = Array.from({length: numTrials * numBlocks}, (_, i) => i + 1)
      let blockCounter = [];
      let blockFlag = 0;

      let array = [0, 0, 0, 0];
      let arrow = 0;
      const imgWidth = 250;
      const imgHeight = 250;
      const fixTime = 2000;
      const arrowTime = 250;
      const preTime = 250;
      const arrayTime = 200;
      const maskTime = 250;
      const postTime = 50;
      const targetTime = 500;
      const delayTime = 100;
      const feedTime = 500;

      let practiceTrials = [];
      let trials = [];

      /* Pointers for where we are in the experiment: */
      let trialNumber = 0;
      let mouseClick = -1;
      let randrotate = 0;
      let angleDeg = 0;
      let curError = 360;
      let seed = [];
      let flip = 0;
      let survey = 0;
      let waitObject = 0;
      let ULcolor = -999;
      let URcolor = -999;
      let LLcolor = -999;
      let LRcolor = -999;
      let TrialConfidence = [];
      let AlignedError = [];
      let arrowColor = [];
      let targetColor = [];
      let colorResp = [];
      let alignedError = [];
      let upLeftColor = [];
      let upRightColor = [];
      let downLeftColor = [];
      let downRightColor = [];
      let condition = [];
      let wheelAngle = [];
      let wheelDirection = [];
      let colorDirection = [];
      var wheelDirectionT = -1;
      var colorDirectionT = -1;
      var wheelAngleT = -1;
      var angle = 0;
      let arrowBias = 0;
      let startExpTime = new Date().getTime();
      const expDate = new Date();
      let mouseMoved = 0;
      let blockStart = 0;
      let age = 0;
      let sex = -999;
      let ethnicity = -999;
      let initials = -999;

      let arrowStart = 0;
      let arrowDur = [];
      let preStart = 0;
      let preDur = [];
      let squareStart = 0;
      let squareDur = [];
      let maskStart = 0;
      let maskDur = [];
      let postStart = 0;
      let postDur = [];
      let targetStart = 0;
      let targetDur = [];
      let blankStart = 0;
      let blankDur = [];
      let respStart = 0;
      let respTime = [];

      var preCued = -1;
      var colorT = -1;
      var colorUL = -1;
      var colorUR = -1;
      var colorLL = -1;
      var colorLR = -1;
      var xClick = -1;
      var yClick = -1;
      var relClick = -1;

      function GetInfo() {
        age = prompt('Before we start, can you tell me how old you are (in years)?');

        while (age > 40 || age < 18 || !(age>=18)) {
          age = prompt('Can you tell me how old you are (e.g., 25, not the year you were born)?');
        }

        sex = prompt('And are you male (M), female (F), non-binary (NB), or prefer not to answer (NA)?');

        while (!(sex == 'M' || sex == 'm' || sex == 'male' || sex == 'Male' || sex == 'F' || sex == 'f' || sex == 'female' || sex == 'Female' || sex == 'NB' || sex == 'nb' || 'Nb' || sex == 'NA' || sex == 'na' || 'Na' || 'N/A' || 'n/a' || 'N/a')) {
          sex = prompt('Are you male (M), female (F), non-binary (NB), or prefer not to answer (NA)? Type one of the options shown in parentheses.');
        }
        if (sex == 'M' || sex == 'm' || sex == 'male' || sex == 'Male') {
          sex = 'm';
        } else if (sex == 'F' || sex == 'f' || sex == 'female' || sex == 'Female') {
          sex = 'f';
        } else if (sex == 'NB' || sex == 'nb' || 'Nb') {
          sex = 'nb';
        } else if (sex == 'NA' || sex == 'na' || 'Na' || 'N/A' || 'n/a' || 'N/a') {
          sex = 'na';
        }

        ethnicity = prompt('How do you describe your ethnicity?');
        initials = prompt('What are your initials (e.g., John Doe would be "JD")?');
        subjID = initials + '_' + age + '_' + startDate.getMonth() + '_' + startDate.getDate() + '_' + startDate.getHours();

        $('#instructions').hide();
        $('#showTrial').show();
        $('#fixation').hide();
        $('#arrow').hide();
        $('#allItems').hide();
        $('#masks').hide();
        $('#targ').hide();
        $('#response').hide();
        $('#confidence').hide();
        $('#feedback').hide();
        $('#blockBreak').hide();
        StartExperiment()
      }

        /* Start the experiment, this function is the first to operate! */
      function StartExperiment() {
        TrialSequence();

        alert('Thanks! The experiment will now begin. Try to remember all the colored squares!')

        // save a file letting me know that someone made it this far
        const blobx = new Blob([JSON.stringify(subjID)], {type: "application/json"});
        const storageRefx = firebase.storage().ref('started/' + subjID + '.json');
        storageRefx.put(blobx);

        window.location.href = '#openModal';
      }

      function randperm(maxValue){
        // first generate number sequence
        var permArray = new Array(maxValue);
        for(var i = 0; i < maxValue; i++){
            permArray[i] = i;
        }
        // draw out of the number sequence
        for (var i = (maxValue - 1); i >= 0; --i){
            var randPos = Math.round(i * Math.random());
            var tmpStore = permArray[i];
            permArray[i] = permArray[randPos];
            permArray[randPos] = tmpStore;
        }
        return permArray;
      }

      var arrowBlocks = [];
      var targetBlocks = [];

      function TrialSequence() {
        let preCuesPos = [];
        let preCuesNeg = [];
        let postCues = [];
        var arrowSquare = [];
        var targetSquare = [];

        preCuesPos[0] = 1;
        preCuesPos[1] = 1;
        preCuesPos[2] = 1;
        preCuesPos[3] = 1;
        preCuesPos[4] = 1;
        preCuesPos[5] = 1;
        preCuesPos[6] = 1;
        preCuesPos[7] = 1;
        postCues[0] = 1;
        postCues[1] = 1;
        postCues[2] = 1;
        postCues[3] = 1;
        postCues[4] = 1;
        postCues[5] = 2;
        postCues[6] = 3;
        postCues[7] = 4;
        preCuesPos[8] = 2;
        preCuesPos[9] = 2;
        preCuesPos[10] = 2;
        preCuesPos[11] = 2;
        preCuesPos[12] = 2;
        preCuesPos[13] = 2;
        preCuesPos[14] = 2;
        preCuesPos[15] = 2;
        postCues[8] = 2;
        postCues[9] = 2;
        postCues[10] = 2;
        postCues[11] = 2;
        postCues[12] = 2;
        postCues[13] = 3;
        postCues[14] = 4;
        postCues[15] = 1;
        preCuesPos[16] = 3;
        preCuesPos[17] = 3;
        preCuesPos[18] = 3;
        preCuesPos[19] = 3;
        preCuesPos[20] = 3;
        preCuesPos[21] = 3;
        preCuesPos[22] = 3;
        preCuesPos[23] = 3;
        postCues[16] = 3;
        postCues[17] = 3;
        postCues[18] = 3;
        postCues[19] = 3;
        postCues[20] = 3;
        postCues[21] = 4;
        postCues[22] = 1;
        postCues[23] = 2;
        preCuesPos[24] = 4;
        preCuesPos[25] = 4;
        preCuesPos[26] = 4;
        preCuesPos[27] = 4;
        preCuesPos[28] = 4;
        preCuesPos[29] = 4;
        preCuesPos[30] = 4;
        preCuesPos[31] = 4;
        postCues[24] = 4;
        postCues[25] = 4;
        postCues[26] = 4;
        postCues[27] = 4;
        postCues[28] = 4;
        postCues[29] = 1;
        postCues[30] = 2;
        postCues[31] = 3;
            
        preCuesNeg[0] = -1;
        preCuesNeg[1] = -1;
        preCuesNeg[2] = -1;
        preCuesNeg[3] = -1;
        preCuesNeg[4] = -1;
        preCuesNeg[5] = -1;
        preCuesNeg[6] = -1;
        preCuesNeg[7] = -1;
        postCues[32] = 1;
        postCues[33] = 1;
        postCues[34] = 1;
        postCues[35] = 1;
        postCues[36] = 1;
        postCues[37] = 2;
        postCues[38] = 3;
        postCues[39] = 4;
        preCuesNeg[8] = -2;
        preCuesNeg[9] = -2;
        preCuesNeg[10] = -2;
        preCuesNeg[11] = -2;
        preCuesNeg[12] = -2;
        preCuesNeg[13] = -2;
        preCuesNeg[14] = -2;
        preCuesNeg[15] = -2;
        postCues[40] = 2;
        postCues[41] = 2;
        postCues[42] = 2;
        postCues[43] = 2;
        postCues[44] = 2;
        postCues[45] = 3;
        postCues[46] = 4;
        postCues[47] = 1;    
        preCuesNeg[16] = -3;
        preCuesNeg[17] = -3;
        preCuesNeg[18] = -3;
        preCuesNeg[19] = -3;
        preCuesNeg[20] = -3;
        preCuesNeg[21] = -3;
        preCuesNeg[22] = -3;
        preCuesNeg[23] = -3;
        postCues[48] = 3;
        postCues[49] = 3;
        postCues[50] = 3;
        postCues[51] = 3;
        postCues[52] = 3;
        postCues[53] = 4;
        postCues[54] = 1;
        postCues[55] = 2;    
        preCuesNeg[24] = -4;
        preCuesNeg[25] = -4;
        preCuesNeg[26] = -4;
        preCuesNeg[27] = -4;
        preCuesNeg[28] = -4;
        preCuesNeg[29] = -4;
        preCuesNeg[30] = -4;
        preCuesNeg[31] = -4;
        postCues[56] = 4;
        postCues[57] = 4;
        postCues[58] = 4;
        postCues[59] = 4;
        postCues[60] = 4;
        postCues[61] = 1;
        postCues[62] = 2;
        postCues[63] = 3;

        let trialCues1 = preCuesPos.concat(preCuesNeg);
        let trialCues2 = postCues;
        for (j = 0; j < numBlocks; j++) {
          let randomizeColumns = randperm(64); 
          for (i = 0; i < numTrials; i++) {
            arrowSquare[i] = trialCues1[randomizeColumns[i]];
            targetSquare[i] = trialCues2[randomizeColumns[i]];
          }

          arrowBlocks = arrowBlocks.concat(arrowSquare);
          targetBlocks = targetBlocks.concat(targetSquare);
        }     
      }

      /* Trials Start */
      function NextTrial() {
        blockMessage = "End of block " + blockNumber + " of " + numBlocks;
        document.getElementById("blockCount").innerHTML = blockMessage;
        if (trialNumber >= numTrials * numBlocks) { // if end of study
          $('#fixation').hide();
          Done();
        } else {
            blockCounter.push(blockNumber);
            // Preload the arrow direction
            preCued = Math.abs(arrowBlocks[trialNumber]);
            $('#arrImg').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Arrows/arrow' + preCued + '.png');

            // Preload the colors of next trial
            colorT = Math.floor(Math.random()*180 + 1);
            var colorA1 = -1;
            var colorA2 = -1;
            var colorO = -1;

            if (arrowBlocks[trialNumber] > 0) {
              if (colorT > 120) {
                colorA1 = colorT - 120;
              } else {
                colorA1 = colorT + 60;
              }

              if (colorA1 > 120) {
                colorA2 = colorA1 - 120;
              } else {
                colorA2 = colorA1 + 60;
              }
            } else {
              if (colorT > 120) {
                colorA2 = colorT - 120;
              } else {
                colorA2 = colorT +60;
              }

              if (colorA2 >120) {
                colorA1 = colorA2 - 120;
              } else {
                colorA1 = colorA2 + 60;
              }
            }

            if (colorT > 90) {
              colorO = colorT - 90;
            } else {
              colorO = colorT + 90;
            }

            if (targetBlocks[trialNumber] == 1) {
              colorUL = colorT;
              colorUR = colorA1;
              colorLL = colorA2;
              colorLR = colorO;
            } else if (targetBlocks[trialNumber] == 2) {
              colorUL = colorA2;
              colorUR = colorT;
              colorLL = colorO;
              colorLR = colorA1;
            } else if (targetBlocks[trialNumber] == 3) {
              colorUL = colorA1;
              colorUR = colorO;
              colorLL = colorT;
              colorLR = colorA2;
            } else {
              colorUL = colorO;
              colorUR = colorA2;
              colorLL = colorA1;
              colorLR = colorT;
            }

            upLeftColor.push(colorUL*2);
            upRightColor.push(colorUR*2);
            downLeftColor.push(colorLL*2);
            downRightColor.push(colorLR*2);
            targetColor.push(colorT*2);

            $('#squareUL').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Squares/square' + colorUL + '.png'); //change UL image, run during ITI fixation
            $('#squareUR').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Squares/square' + colorUR + '.png'); //change UR image, run during ITI fixation
            $('#squareLL').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Squares/square' + colorLL + '.png'); //change LL image, run during ITI fixation
            $('#squareLR').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Squares/square' + colorLR + '.png'); //change LR image, run during ITI fixation
          
          
            //Preload target cue location
            if (targetBlocks[trialNumber] == 1) {
              $('#targetImg').attr('style', 'position:absolute; top:0; left:0;');
            } else if (targetBlocks[trialNumber] == 2) {
              $('#targetImg').attr('style', 'position:absolute; top:0; right:0;');
            } else if (targetBlocks[trialNumber] == 3) {
              $('#targetImg').attr('style', 'position:absolute; bottom:0; left:0;');
            } else {
              $('#targetImg').attr('style', 'position:absolute; bottom:0; right:0;');
            }

            //Preload color wheel
            wheelAngleT = Math.floor(Math.random()*360 + 1);
            wheelAngle.push(wheelAngleT);
            wheelDirectionT = Math.floor(Math.random()*2 + 1);
            wheelDirection.push(wheelDirectionT);
            colorDirectionT = Math.floor(Math.random()*2 + 1);
            colorDirection.push(colorDirectionT);
            var wheelFlip = [];
            var xClick = -1;
            var yClick = -1;
            if (wheelDirectionT == 1) {
              wheelFlip = 'CW';
            } else {
              wheelFlip = 'CCW';
            }

            $('#wheel').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Wheels/wheel' + wheelFlip + '.png');
            $('#feedImg').attr('src', 'https://wnarhi.github.io/Arrow/Stimuli/Wheels/feedback' + wheelFlip + colorT + '.png');

            $('#fixation').show();
            setTimeout(function() {
              ShowingTrial();
            }, fixTime);
          
        }
      }

      function ShowingTrial() {
        $('#arrow').show();
        $('#arrow').css('cursor:none;');
        arrowStart = new Date;
        setTimeout(function() {
          $('#arrow').hide();
          arrowDur[trialNumber] = new Date - arrowStart;
          preStart = new Date;
          setTimeout(function() {
            preDur[trialNumber] = new Date - preStart;
            $('#allItems').show();
            $('#allItems').css('cursor:none;');
            squareStart = new Date;
            setTimeout(function() {
              $('#allItems').hide();
              squareDur[trialNumber] = new Date - squareStart;
              $('#masks').show();
              $('#masks').css('cursor:none;');
              maskStart = new Date;
              setTimeout(function() {
                $('#masks').hide();
                maskDur[trialNumber] = new Date - maskStart;
                postStart = new Date;
                setTimeout(function() {
                  postDur[trialNumber] = new Date - postStart;
                  $('#targ').show();
                  $('#targ').css('cursor:none;');
                  targetStart = new Date;
                  setTimeout(function() {
                    $('#targ').hide();
                    targetDur[trialNumber] = new Date - targetStart;
                    blankStart = new Date;
                    setTimeout(function() {
                      $('#fixation').hide();
                      blankDur[trialNumber] = new Date - blankStart;
                      $('#wheel').css('transform', 'rotate(' + wheelAngleT + 'deg)');
                      $('#response').show();
                      respStart = new Date;
                      document.getElementById("response").addEventListener("click", function(event) {
                        respTime[trialNumber] = new Date - respStart;
                        xClick = event.clientX;
                        yClick = event.clientY;
                        relClick = Math.pow(Math.pow((xClick - wheelXcenter), 2) + Math.pow((yClick - wheelYcenter), 2), .5);
                        if (relClick < 150 && relClick > 100) {
                          $('#confidence').show();
                          $('#confBox').focus();
                          document.getElementById("confBox").onkeyup = function() {
                            ConfReport();                         
                          }
                        }
                      });
                    }, delayTime);
                  }, targetTime);
                }, postTime);
              }, maskTime);
            }, arrayTime);
          }, preTime);
        }, arrowTime);
      };

      function ConfReport() {
        let confInput = document.getElementById("confBox");
        let confResp = confInput.value;
        if (confResp == 1) {
          $('#response').hide();
          $('#feedImg').css('transform', 'rotate(' + wheelAngleT + 'deg)');
          $('#feedback').show();
          setTimeout(function() {
            TrialConfidence.push(1);
            ProcessResponse()
          }, feedTime);
        } else if (confResp == 2) {
          $('#response').hide();
          $('#feedImg').css('transform', 'rotate(' + wheelAngleT + 'deg)');
          $('#feedback').show();
          setTimeout(function() {
            TrialConfidence.push(2);
            ProcessResponse()
          }, feedTime);
        } else if (confResp == 3) {
          $('#response').hide();
          $('#feedImg').css('transform', 'rotate(' + wheelAngleT + 'deg)');
          $('#feedback').show();
          setTimeout(function() {
            TrialConfidence.push(3);
            ProcessResponse()
          }, feedTime);
        } else if (confResp == 4) {
          $('#response').hide();
          $('#feedImg').css('transform', 'rotate(' + wheelAngleT + 'deg)');
          $('#feedback').show();
          setTimeout(function() {
            TrialConfidence.push(4);
            ProcessResponse()
          }, feedTime);
        } else {
          document.getElementById("confBox").value="";
        }
      };

      function ProcessResponse() {
        $('#feedback').hide();
        $('#confidence').hide();
        document.getElementById("confBox").value="";
        ResponseCalculations();
        if ((trialNumber + 1) % numTrials == 0) { // block break
        flag = 0;
          $('#blockBreak').show();
          blockNumber++;
        } else {
          trialNumber++;
          NextTrial();
        }
      }

      function ResponseCalculations() {
        let colorRespT = -1;
        let arrowColorT = -1;
        let colorRespTX = -1;
        let adjustedArrow = -1;
        curError = 360;
        startTime = new Date();

        // Get arrow-cued color
        if (Math.abs(arrowBlocks[trialNumber]) == 1) {
          arrowColorT = colorUL;
        } else if (Math.abs(arrowBlocks[trialNumber]) == 2) {
          arrowColorT = colorUR;
        } else if (Math.abs(arrowBlocks[trialNumber]) == 3) {
          arrowColorT = colorLL;
        } else {
          arrowColorT = colorLR;
        }

        arrowColor.push(arrowColorT*2);

        // Get selected color
        if (wheelDirectionT == 1) {
          angle = ((2 * Math.PI - Math.atan2(wheelYcenter - yClick, xClick - wheelXcenter) - wheelAngleT / 180 * Math.PI) % (2 * Math.PI) + (2 * Math.PI)) % (2 * Math.PI);
        } else {
          angle = ((Math.atan2(wheelYcenter - yClick, xClick - wheelXcenter) + wheelAngleT / 180 * Math.PI) % (2 * Math.PI) + (2 * Math.PI)) % (2 * Math.PI);
        }

        colorRespTX = Math.ceil(angle * 90 / Math.PI);
        colorRespT = (colorRespTX % 180 + 180) % 180;

        if (colorRespT == 0) {
          colorRespT = 180;
        }

        colorResp.push(colorRespT*2);

        // Label the condition
        adjustedArrow = arrowColorT - colorT;

        if (adjustedArrow == 0) {
          conditionT = 0;
        } else if (adjustedArrow == 60 || adjustedArrow == -120) {
          conditionT = 1;
        } else if (adjustedArrow == -60 || adjustedArrow == 120) {
          conditionT = 2;
        } else {
          conditionT = 3;
        }

        condition.push(conditionT);

        // Aligned error
        alignedErrorT = Math.atan2(Math.sin(deg2rad(colorRespT*2) - deg2rad(colorT*2)), Math.cos(deg2rad(colorRespT*2) - deg2rad(colorT*2)));
        alignedErrorT = Math.round(rad2deg(alignedErrorT));

        if (conditionT == 0 && colorDirectionT == 1) {
          alignedErrorT = -alignedErrorT;
        } else if (conditionT == 2) {
          alignedErrorT = -alignedErrorT;
        }

        if (alignedErrorT == -0) {
          alignedErrorT = 0;
        }

        alignedError.push(alignedErrorT)

      }
      
      function deg2rad(ang) {
        return ang / 180 * Math.PI;
      }

      function rad2deg(rad) {
        return rad / Math.PI * 180;
      }

      /* Done with the experiment */
      function Done() {
        document.getElementById("doneText").innerHTML = 'You finished! Just one question before you go:' + 
          '<br><br><i>On a scale from 0(never) to 10(always), how often did the arrow seem to point to the same location as the target cue that appeared after the colored squares?</i><br>' +
          '<br><input type="radio" name="eq" value="0"> 0  ' +
          '<input type="radio" name="eq" value="1"> 1  ' +
          '<input type="radio" name="eq" value="2"> 2  ' +
          '<input type="radio" name="eq" value="3"> 3  ' +
          '<input type="radio" name="eq" value="4"> 4  ' +
          '<input type="radio" name="eq" value="5"> 5  ' +
          '<input type="radio" name="eq" value="6"> 6  ' +
          '<input type="radio" name="eq" value="7"> 7  ' +
          '<input type="radio" name="eq" value="8"> 8  ' +
          '<input type="radio" name="eq" value="9"> 9  ' +
          '<input type="radio" name="eq" value="10"> 10<br>' +
          '<br><br>Any comments for us?<br><br>' +
          '<textarea name="comments" id="comments" style="width: 400px; height: 200px"></textarea><br><br>';
        $('#showTrial').hide();
        $('#done').show();
      }

      function checkEQ() {
        radios = document.getElementsByName("eq");
        if (radios[0].checked + radios[1].checked + radios[2].checked + radios[3].checked + radios[4].checked + radios[5].checked + radios[6].checked + radios[7].checked + radios[8].checked + radios[9].checked + radios[10].checked == 0) {
          alert('Please answer post-experiment question.');
        } else {
          for (i = 0; i < 11; i++) {
            if (radios[i].checked == true) {
              arrowBias = i;
            }
          }
          $('#done').children().hide();
          $('#done').hide();
          $('#debrief').show();
        }
      }

      /* What to save and put it on server */
      function SaveData() {
        $('#saving').show();
        const endDate = new Date().getTime();
        const d = {
          "Date": expDate,
          "ID": subjID,
          "startExpTime": startExpTime,
          "endExpTime": endDate,
          "totalExpTime": endDate - startExpTime,
          "userAgent": navigator.userAgent,
          "Seeds": seed,
          "Trial": trialList,
          "Block": blockCounter,
          "Condition": condition,
          "ArrowCued": arrowBlocks,
          "TargetCued": targetBlocks,
          "ArrowColor": arrowColor,
          "TargetColor": targetColor,
          "ResponseColor": colorResp,
          "UpLeftColor": upLeftColor,
          "UpRightColor": upRightColor,
          "DownLeftColor": downLeftColor,
          "DownRightColor": downRightColor,
          "AlignedError": alignedError,
          "ResponseTime": respTime,
          "Confidence": TrialConfidence,
          "WheelRotation": wheelAngle,
          "WheelDirection": wheelDirection,
          "ArrowDuration": arrowDur,
          "PreDuration": preDur,
          "SquareDuration": squareDur,
          "MaskDuration": maskDur,
          "PostDuration": postDur,
          "TargetDuration": targetDur,
          "BlankDuration": blankDur,
          "ExitQuestion": arrowBias,
          "Comments": $('#comments').val(),
          "Age": age,
          "Sex": sex,
          "Ethnicity": ethnicity,
          "Initials": initials,
          "ExpName": 'ProbArrowSpacing',
          "SeedRNG": SeedRNG
        };

        /* save to Firebase server */
        const blob = new Blob([JSON.stringify(d)], {
          type: "application/json"
        });
        const storageRef = firebase.storage().ref('ProbArrowV2REP/' + subjID + '.json');
        storageRef.put(blob);

        document.getElementById("saving").innerHTML = "Submitting...";

        /* submit after waiting a few seconds to make sure data got sent */
        setTimeout(function() {
          document.getElementById("saving").innerHTML = "Data saved. Thank you for your participation!";
          
          // close full screen if still full-screened
          if (document.cancelFullScreen) {
            document.cancelFullScreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
          }
        }, 3000);
      }
      

      /* running on IE? */
      function isIE() {
        ua = navigator.userAgent;
        var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
        return is_ie;
      }

      $(function() { // check if Safari, IE, mobile
        if (!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)) { // if Safari
            $('body').html('Unfortunately this study does not work in Safari. It works in Chrome only. Sorry!');
        } else if (isIE()) { // if IE
            $('body').html('Unfortunately this study does not work in Internet Explorer. It works in Chrome only. Sorry!');
        } else if (
            /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i
            .test(navigator.userAgent) ||
            /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
            .test(navigator.userAgent.substr(0, 4))) {
            $('body').html('Unfortunately this study does not work on mobile devices. It works on desktop versions of Chrome only. Sorry!'); // dont allow mobile
        } else if (window.chrome !== null && typeof window.chrome !== "undefined" && window.navigator.vendor == "Google Inc."){
        } else {
          $('body').html('Unfortunately, this study only works on desktop versions of Chrome. If this is a mistake and you are using Chrome, try updating your browser. Sorry!');
        }
      });

      function requestFullScreen() {
        var el = document.body;

        // Supports most browsers and their versions.
        var requestMethod = el.requestFullScreen || el.webkitRequestFullScreen ||
          el.mozRequestFullScreen || el.msRequestFullScreen;

        if (requestMethod) {

          // Native full screen.
          requestMethod.call(el);

        } else if (typeof window.ActiveXObject !== "undefined") {

          // Older IE.
          var wscript = new ActiveXObject("WScript.Shell");

          if (wscript !== null) {
            wscript.SendKeys("{F11}");
          }
        }
      }

    </script>
  </body>
</html>
